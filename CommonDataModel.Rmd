# (PART) Uniform Data Representation {-} 

# The Common Data Model {#CommonDataModel}

*Chapter lead: Clair Blacketer*

観察データは、医療を受けている間に患者に何が起こっているかを見ることができます。データは、世界中のますます多くの患者のために収集・保存され、ビッグヘルスデータと呼ばれるものが生み出されています。これらの収集の目的は3つあります。(i) 研究を直接促進するため（多くの場合、調査やレジストリデータの形で）、(ii) ヘルスケアの実施を支援するため（通常、EHR - Electronic Health Recordsと呼ばれる）、(iii) 診療の支払いを管理するため（通常、クレームデータと呼ばれる）である。この3つはいずれも臨床研究に日常的に利用されており、後者の2つは二次利用データとして利用されており、一般的には3つとも独自のフォーマット化と内容の符号化が行われている。\index{CDM |参照 {Common Data Model}} \index{relational data model|参照 {Common Data Model}}


なぜ観察医療データのための共通データモデルが必要なのか？

主なニーズにもよりますが、どの観察データベースもすべての臨床イベントを等しく把握しているわけではありません。そのため、研究結果は多くの異種データソースから得られ、潜在的な捕捉バイアスの影響を理解するために比較対照しなければなりません。さらに、検定力を持った結論を出すためには、大量の観察患者が必要です。そのため、複数のデータソースを同時に評価し、分析する必要があることを説明しています。そのためには、データを共通のデータ標準に調和させる必要があります。また、患者データには高いレベルでの保護が必要です。従来のように分析目的でデータを抽出するには、厳格なデータ利用契約と複雑なアクセス制御が必要です。共通データ標準は、抽出ステップを省略し、標準化された分析をネイティブな環境で実行できるようにするー分析者にデータを提供するのではなく、データ上で分析を実行できるようにすることで、この必要性を軽減することができます。

この標準は、Common Data Model (CDM)によって提供されます。CDMは、その標準化された内容と組み合わせることで（\@ref(StandardizedVocabularies)章参照）、研究方法を体系的に適用して、意味のある比較可能で再現性のある結果を生み出すことができるようになります。本章では、データモデル自体の概要、デザイン、規約、および選択された表について説明します。

CDMのすべてのテーブルの概要は、図 \@ref(fig:cdmDiagram) に掲載されています。\index{Common Data Model!data model diagram}

```{r cdmDiagram, fig.cap="Overview of all tables in the CDM version 6.0の全てのテーブルの概容.全てのリレーションシップが提示されていないことに留意。",echo=FALSE, out.width="100%"}
knitr::include_graphics("images/CommonDataModel/cdmDiagram.png")
```
## Design Principles

CDMは\index{Common Data Model!design principles}の典型的な観測研究目的に最適化されています。

* 特定の医療介入（薬物曝露、処置、医療政策の変更など）とその結果（状態、処置、他の薬物曝露など）を持つ患者集団を特定すること
* 人口統計学的情報、病歴、医療提供、利用とコスト、罹患率、治療法、一連の治療などの様々なパラメータについて、これらの患者集団の特性化を行うこと
* 個々の患者におけるこれらの転帰の発生を予測すること-\@ref(PatientLevelPrediction)章を参照のこと。
* これらの介入が集団に与える効果を推定すること-\@ref(PopulationLevelEstimation)章を参照のこと。

この目的を達成するために、CDMの開発は以下の設計方針に従っています。

  - **目的の適合性**: CDMは、医療提供者や支払者の運用ニーズに対応することを目的とするのではなく、分析に最適な方法で整理されたデータを提供することを目的とします。\index{Common Data Model!suitability for purpose}
  - **データ保護**: 患者さんの氏名、正確な生年月日など、患者さんの身元や保護に危険を及ぼす可能性のあるデータはすべて制限されています。乳幼児の研究のための正確な生年月日など、研究でより詳細な情報が必要な場合は例外となります。
  - **ドメインの設計**:ドメインは人物中心のリレーショナル・データ・モデルでモデル化されており、各レコードについて、人物の身元と日付が最低限の情報として取得されています。ここでいうリレーショナル・データ・モデルとは、データが主キーと外部キーでリンクされたテーブルの集合として表現されるものです。
  - **ドメインの根拠**: ドメインは、分析のユースケース（症状など）があり、ドメインが他に適用できない特定の属性を持っている場合、エンティティ-リレーションシップモデルで識別され、個別に定義されます。 他のすべてのデータは、エンティティ-属性-値構造の観測テーブルの観測として保存することができます。\index{Common Data Model!domains}
  - **標準化された用語集**: 記録の内容を標準化するために、CDMは、必要かつ適切な対応する標準的な医療概念をすべて含んだ標準用語集に依存しています。
  - **既存の用語集の再利用**: 国立医学図書館、退役軍人局、疾病管理予防センターなど、国や業界の標準化や用語集を定義する組織やイニシアティブを活用します。
  - **ソースコードの管理**: すべてのコードが標準用語にマッピングされているにもかかわらず、モデルは情報が失われないように元のソースでのコードも保存します。\index{Common Data Model!Source Codes} \index{Common Data Model!data loss prevention}
  - **技術的中立性**: CDMは特定の技術を必要としません。Oracle, SQL Serverなどのリレーショナルデータベースでも、SASの分析データセットでも実現可能です。
  - **スケーラビリティ**: CDMは、数億人規模の患者や数十億規模の臨床観察など、あらゆる規模のデータソースに対応できるよう、データ処理や計算解析のために最適化されています。\index{Common Data Model!scalability}:
  - **下位互換性**: 以前のCDMからの変更点はすべてgithubリポジトリ[(https://github.com/OHDSI/CommonDataModel)](https://github.com/OHDSI/CommonDataModel)に明記されています。古いバージョンのCDMは、現在のバージョンから簡単に作成することができ、以前に存在していた情報が失われることはありません。\index{Common Data Model!backwards compatibility}

  
## Data Model Conventions

CDMで採用されている暗黙的規約と明示的規約がいくつかあります。CDMに対して実行されるメソッドの開発者は、これらの規約を理解する必要があります。 \index{Common Data Model!conventions}

### General Conventions of the Model{#model-Conv}

CDM は「個人指向(person-centric)」モデルと考えられており、すべての臨床イベントテーブルが PERSON テーブルにリンクされています。これによって日付や開始日とともに、すべての医療関連イベントを個人別に縦断的に閲覧できるようになっています。この規則の例外は、標準化された医療システムのデータテーブルであり、さまざまなドメインのイベントに直接リンクされています。

### General Conventions of Schemas

スキーマ、またはいくつかのシステムにおけるデータベースユーザーは、読み取り専用テーブルと読み取り書込みテーブルを分離することができます。臨床イベントと用語集テーブルは "CDM "スキーマにあり、エンドユーザーや分析ツールにとっては読み取り専用とみなされます。Webベースのツールやエンドユーザーが操作する必要のあるテーブルは「Results」スキーマに格納されます。Results」スキーマの2つのテーブルは、COHORTとCOHORT_DEFINITONです。これらのテーブルは、ユーザーが定義する可能性のある関心のあるグループを記述することを意図しており、\@ref(Cohorts)章で詳しく説明しています。これらのテーブルは書き込めるので、実行時にCOHORTテーブルにコホートを格納することができます。すべてのユーザに対して1つの読み書きスキーマしかないので、複数のユーザのアクセスをどのように組織化して制御するかはCDMの実装次第です。

### General Conventions of Data Tables

CDMはプラットフォームに依存しません。データ型は、ANSI SQLデータ型（VARCHAR、INTEGER、FLOAT、DATE、DATETIME、CLOB）を使用して一般的に定義されています。精度はVARCHARのみに提供されます。これは、最低限必要な文字列の長さを反映していますが、具体的なCDMのインスタンス内で拡張することができます。CDM は、date と datetime のフォーマットを規定していません。CDMに対する標準的なクエリは、ローカル・インスタンスと日付/日付時間構成のために異なるかもしれません。

*注*: データモデル自体がプラットフォーム非依存である一方、それを使用するために構築されたツールの多くは、特定の環境を必要とします。この詳細は、\@ref(OhdsiAnalyticsTools)章を参照してください。

### General Conventions of Domains{#domains}

異なる性質のイベントは、ドメインに編成されます。これらのイベントは、ドメイン固有のテーブルとフィールドに格納され、標準化された用語集で定義されたドメイン固有の標準概念によって表現されます。各標準概念は、どのテーブルに記録されるかを定義する独自のドメイン割り当てを持っています。正しいドメインの割り当てについてコミュニティで議論されていますが、この厳密なドメイン-テーブル-フィールド対応規則により、どのようなコードや概念にも常に格納すべき場所が明確になっていることが保証されています。例えば、徴候、症状、診断の概念はConditionドメインのものであり、CONDITION_OCCURRENCEテーブルのCONDITION_CONCEPT_IDに記録されます。いわゆる処置薬(Procedure Drugs)は、通常、ソースデータの処置テーブルにおいて処置コードを用いて記録されます。CDMでは、これらのレコードはDRUG_EXPOSUREテーブルに記録されています。表 \@ref(tab:domains)に示されているように、合計30のドメインがあります。

Table: (\#tab:domains) それぞれのドメインに所属する標準概念の個数

|Concept Count|Domain ID|Concept Count|Domain ID
|:---------- |:---------------------------- |:---------- |:----------------------------
|1731378|Drug|183|Route
|477597|Device|180|Currency
|257000|Procedure|158|Payer
|163807|Condition|123|Visit
|145898|Observation|51|Cost
|89645|Measurement|50|Race
|33759|Spec Anatomic Site|13|Plan Stop Reason
|17302|Meas Value|11|Plan
|1799|Specimen|6|Episode
|1215|Provider Specialty|6|Sponsor
|1046|Unit|5|Meas Value Operator
|944|Metadata|3|Spec Disease Status
|538|Revenue Code|2|Gender
|336|Type Concept|2|Ethnicity
|194|Relationship|1|Observation Type

### Representation of Content Through Concepts 

CDMデータテーブルでは、各レコードの内容は完全に正規化され、概念によって表現されます。概念は、一般的な参照テーブルとして機能するCONCEPTテーブルへの外部キーであるCONCEPT_ID値を持つイベントテーブルに格納されます。すべてのCDMインスタンスは、概念への参照として同じCONCEPTテーブルを使用し、これは共通データモデルとともに相互運用性の鍵となるメカニズムであり、OHDSI研究ネットワークの基礎となっています。標準概念が存在しないか、または識別できない場合、CONCEPT_IDの値は0に設定され、存在しない概念、未知の値、またはマッピング不可能な値を表します。

CONCEPTテーブルのレコードには、各概念に関する詳細な情報（名前、ドメイン、クラスなど）が含まれています。概念、概念の関係、概念の祖先、およびその他の概念に関する情報は、標準化された用語集の表に記載されています（\@ref(StandardizedVocabularies)章参照）。


### General Naming Conventions of Fields

すべてのテーブルの変数名は、1つの規則に従います。:

Table: (\#tab:fieldConventions) フィールド名の規則

|Notation|Description|
|:------------------------------|:-------------------------------------------------------|
|[Event]_ID| 各レコードの一意の識別子で、イベントテーブル間の関係を確立するための外部キーとして機能します。例えば、PERSON_ID は各個人を一意に識別します。VISIT_OCCURRENCE_IDは来院を一意に識別します。|

|[Event]_CONCEPT_ID|CONCEPT参照テーブルの標準コンセプトレコードへの外部キー。これはイベントの主な表現であり、すべての標準化された分析の基盤となります。例えば、CONDITION_CONCEPT_ID = [31967](http://athena.ohdsi.org/search-terms/terms/31967)にはSNOMEDコンセプトの「吐き気」への参照値が含まれています。|

|[Event]_SOURCE _CONCEPT_ID|CONCEPT参照テーブル内のレコードへの外部キー。この概念はSource Value(下記)と同等のもので、たまたま標準概念になっている場合もあり、その場合は[Event]_CONCEPT_ID、または別の非標準概念と同一のものになります。例えば、CONDITION_SOURCE_CONCEPT_ID = [45431665](http://athena.ohdsi.org/search-terms/terms/45431665)は、Read用語集では "Nausea "の概念を表し、類似のCONDITION_CONCEPT_IDは、標準SNOMED-CT概念[31967](http://athena.ohdsi.org/search-terms/terms/31967)です。標準概念だけがイベントの意味的な内容を曖昧さのない方法で表現できるため、標準分析アプリケーションにおいて相互互換性のないソース概念を使用することは推奨されません。|

|[Event]_TYPE_CONCEPT_ID | CONCEPT参照テーブルのレコードへの外部キーで、標準化された用語集の中で標準化されたソース情報の元となるレコードを表します。フィールド名にもかかわらず、これはイベントのタイプや概念のタイプではなく、このレコードを作成したキャプチャメカニズムを宣言していることに注意してください。例えば、DRUG_TYPE_CONCEPT_IDは、薬剤レコードが薬局での調剤イベント（"Pharmacy dispensing"）またはe-prescribingアプリケーション（"Prescription written"）から派生したものであるかを識別します。|

|[Event]_SOURCE_VALUE|このイベントがソースデータでどのように表現されたかを反映したコードまたはフリーテキスト文字列です。これらのソース値はデータソース間で調整されていないため、標準的な分析アプリケーションでは使用しないでください。たとえば、CONDITION_SOURCE_VALUEには、ドットを省略した表記で書かれたICD-9コード787.02に対応する「78702」のレコードが含まれている場合があります。|

### Difference Between Concepts and Source Values{#concepts-Sources}

多くのテーブルは、ソース値、ソース概念、および標準概念として、複数の場所に同等な情報を保有しています。

* **ソース値**は、ソースデータ内のイベントレコードの元の表現です。ソース値は、ICD9CM、NDC、Read のようなパブリックドメインであることが多く広く使われているコーディング体系のコード、CPT4、GPI、MedDRA のような独自のコーディング体系、またはソースデータでのみ使用されている統制用語(女性の場合は F、男性の場合は M）のようなコードであることがあります。また、標準化されておらず管理されていない短いフリーテキストのフレーズでもよいです。ソース値はデータテーブルの[Event]_SOURCE_VALUE フィールドに格納されます。
* **概念**は、臨床事実の意味を正規化するCDM固有のエンティティです。ほとんどの概念は、医療における既存の公的または独自のコーディング体系に基づいていますが、他のコンセプトは（CONCEPT_CODEは "OMOP "で始まる）一から作成されたものもあります。概念はすべてのドメインで一意のIDを持っています。
* **ソース概念**は、ソースで使用されているコードを表す概念です。ソース概念は、既存の一般公開されたまたは独自のコーディング体系にのみ使用され、OMOPで作成された概念には使用されません。ソース概念は、データテーブルの [Event]_SOURCE_CONCEPT_ID フィールドに格納されます。
* **標準概念**とは、すべてのデータベースにまたがる臨床エンティティの意味を一意に定義するために使用される概念であり、ソースで使用されるコーディング体系とは独立しています。標準概念は、通常、既存の公開または独自の用語集ソースから引用されます。標準概念と同等の意味を持つ非標準概念は、標準化された語彙の中で標準概念にマッピングされているます。標準概念は、データテーブルの[Event]_CONCEPT_IDフィールドで参照されます。

ソース値は、利便性と品質保証（QA）の目的のためにのみ提供されます。それらは、特定のデータ ソースのコンテキストでのみ意味を持つ情報を含んでいる場合があります。ソース値とソース概念の使用は任意ですが、ソース・データがコーディング・システムを使用している場合は***強く推奨**されます。ただし、標準概念は **必須** です。この標準概念の使用が必須なのは、すべての CDM インスタンスが同じ言語を話すことを可能にするためです。例えば、症状「肺結核」（TB, Figure \@ref(fig:pulmTubICD9))は、結核の ICD9CMコードが011であることを示しています。

```{r pulmTubICD9, fig.cap="肺結核のICD9CMコード",echo=FALSE, out.width="75%", fig.align="center"}
knitr::include_graphics("images/CommonDataModel/pulmTubICD9.png")
```

文脈がなければ、コード011はUB04の用語集から "Hospital Inpatient (Including Medicare Part A) "と解釈されたり、DRGの用語集から "Nervous System Neoplasms without Complications, Comorbidities "と解釈されたりする可能性があります。ここで、ソース概念と標準概念の両方の概念IDが重要なものとなります。011 ICD9CMコードを表すCONCEPT_ID値は[44828631](http://athena.ohdsi.org/search-terms/terms/44828631)です。これは、ICD9CMをUBO4やDRGと区別するものです。ICD9CM TB Source Conceptは、図@ref(fig:pulmTubMap)に示すように、"Non-standard to Standard map (OMOP) "という関係を通じてSNOMED用語集の標準概念[253954](http://athena.ohdsi.org/search-terms/terms/253954)にマッピングされています。このようなマッピング関係は、Read、ICD10、CIEL、MeSHコードなどにも存在し、SNOMEDの標準概念を参照する研究では、サポートされているすべてのソースコードが含まれていることが確認されています。

```{r pulmTubMap, fig.cap="肺結核のSNOMED コード",echo=FALSE, out.width="100%"}
knitr::include_graphics("images/CommonDataModel/pulmTubMap.png")
```

標準概念とソース概念の関係の例を表 \@ref(tab:conditionOccurrence)に示します。

## CDM Standardized Tables

\index{Common Data Model!standardized tables}

CDMには、16個の臨床イベントテーブル、10個の用語集テーブル、2個のメタデータテーブル、4個の医療システムデータテーブル、2個の医療経済データテーブル、3個の標準化された派生要素、2個の結果スキーマテーブルが含まれています。これらのテーブルは CDM Wiki[^cdmWikiUrl1]で全て規定されています。

[^cdmWikiUrl1]: https://github.com/OHDSI/CommonDataModel/wiki

これらの表が実際にどのように使用されているかを説明するために、この章の残りの部分では、ある人物のデータを共通のスレッドとして使用します。

### Running Example: Endometriosis 

子宮内膜症は、通常は女性の子宮内膜にある細胞が体の他の場所に発生する痛みを伴う疾患です。重症化すると、不妊症、腸や膀胱の問題につながることがあります。以下のセクションでは、ある患者のこの疾患の経験と、それが共通データモデルでどのように表現されるかを詳述します。

```{r Lauren1, echo=FALSE, out.width="50%", fig.align="center"}
knitr::include_graphics("images/CommonDataModel/Lauren.jpg")
```

> この痛みを伴う旅の一歩一歩において、私がどれほどの痛みを抱えているのかを皆に納得させなければなりませんでした。

ローレンさんは何年も前から子宮内膜症の症状を経験していましたが、診断を受ける前に卵巣の嚢胞が破裂してしまいました。ローレンさんについての詳細は、[https://www.endometriosis-uk.org/laurens-story](https://www.endometriosis-uk.org/laurens-story)で読むことができます。


### PERSON Table{#person}

#### What Do We Know About Lauren?  {-}

* 36歳の女性です。
* 誕生日は1982年3月12日です。
* 彼女は白人です。
* 彼女はイギリス人です

この情報を念頭におくと、彼女のPERSONのテーブルはこんな感じになるかもしれません。: 

Table: (\#tab:person) The PERSON table.

|Column name|Value|Explanation
|:---------------------|:-----------|:--------------------------------------
|PERSON_ID|1|PERSON_IDは、ソースから直接、またはビルドプロセスの一部として生成された整数値でなければなりません。|
|GENDER_CONCEPT_ID|8532|女性の性別を示す概念IDは[8532](http://athena.ohdsi.org/search-terms/terms/8532)です。|
|YEAR_OF_BIRTH|1982| |
|MONTH_OF_BIRTH|3| |
|DAY_OF_BIRTH|12| |
|BIRTH_DATETIME|1982-03-12 00:00:00|時間がわからない場合は深夜を使用します。|
|DEATH_DATETIME|　|　|
|RACE_CONCEPT_ID|8527|白人種族を指す概念IDは [8527](http://athena.ohdsi.org/search-terms/terms/8527)です。英語民族は[4093769](http://athena.ohdsi.org/search-terms/terms/4093769)です。 どちらが正しいかということになれば、後者が前者に収斂されます。ethnicityはここではRacesの一部として格納されており、ETHNICITY_CONCEPTには格納されていないことに注意してください。|

|ETHNICITY_CONCEPT_ ID|38003564|これはヒスパニック系を区別するための米国的な表記です。民族（この場合は英語）はRACE_CONCEPT_IDに格納されています。米国外ではこれは使われていません。[38003564](http://athena.ohdsi.org/search-terms/terms/38003564) は "非ヒスパニック"を参照しています。|
|LOCATION_ID||彼女の住所は不明です。|
|PROVIDER_ID||彼女の主治医は不明です。|
|CARE_SITE||彼女のかかりつけ医療機関は不明です。|
|PERSON_SOURCE_ VALUE|1|典型的にはこれがソースデータにおける彼女の識別子になりますが、PERSON_IDと同じであることが多いです。|
|GENDER_SOURCE_ VALUE|F|ソースに表示されている性別の値がここに格納されています。|
|GENDER_SOURCE_ CONCEPT_ID|0|ソース内の性別の値がOHDSIがサポートするコーディングスキームを使用してコーディングされている場合、その概念はここに格納されます。例えば、彼女の性別が "sex-F "であり、それがPCORNet語彙概念[44814665](http://athena.ohdsi.org/search-terms/terms/44814665)にあると記述されていた場合は、このフィールドに入ります。|
|RACE_SOURCE_ VALUE|white|ソースに表示されている人種の値がここに格納されています。|
|RACE_SOURCE_ CONCEPT_ID|0|GENDER_CONCEPT_IDと同じ原理が適用されます。|
|ETHNICITY_SOURCE_ VALUE|english|ソースに表示されている，民族の値がここに格納されます。|
|ETHNICITY_SOURCE_ CONCEPT_ID|0|SGENDER_SOURCE_CONCEPT_IDと同じ原理が適用されます。|

### OBSERVATION_PERIOD Table{#observationPeriod}

OBSERVATION_PERIODテーブルは、少なくとも患者の人口統計学、状態、処置、および医薬品において、妥当な感度と特異性を期待してソースシステムに記録される時間を定義するように設計されています。保険データの場合、これは通常、患者の登録期間となります。電子カルテ（EHR）では、ほとんどの医療システムが、どの医療機関や医療従事者を訪問しているかを判断しないため、より厄介です。次善の策として、システム内の最初の記録は観察期間の開始日とみなされ、最新の記録は終了日とみなされることが多いです。

#### How Is Lauren's Observation Period Defined? {-}


ローレンさんの情報が表のようにEHRシステムに記録されているとします。観測期間から得られた彼女の来意履歴は下記のとおりでした。

Table: (\#tab:encounters) ローレンさんの来院履歴

|Encounter ID|Start date|Stop date|Type|
|:--------|:-----|:------|:-----------
|70|2010-01-06|2010-01-06|outpatient|
|80|2011-01-06|2011-01-06|outpatient|
|90|2012-01-06|2012-01-06|outpatient|
|100|2013-01-07|2013-01-07|outpatient|
|101|2013-01-14|2013-01-14|ambulatory|
|102|2013-01-17|2013-01-24|inpatient|

来院履歴に基づいて、彼女のOBSERVATION_PERIODテーブルは次のようになるかもしれません。

Table: (\#tab:observationPeriod) OBSERVATION_PERIODの表

|Column name|Value|Explanation
|:----------------------|:----------|:--------------------------------------
|OBSERVATION_ PERIOD_ID|1|通常、テーブル内の各レコードに対して一意の識別子を作成する自動生成された値です。|
|PERSON_ID|1|これはPERSONテーブルのローラのレコードの外部キーであり、PERSONをOBSERVATION_PERIODテーブルにリンクします。|
|OBSERVATION_PERIOD_ START_DATE|2010-01-06|これは彼女のレコード上で最も早く遭遇した日の開始日です。|
|OBSERVATION_PERIOD_ END_DATE|2013-01-24|Tこれは記録上の彼女の最新の来院履歴の終了日です。|
|PERIOD_TYPE_ CONCEPT_ID|44814725|「Obs Period Type」という概念クラスを持つ語彙の中で最良の選択肢は[44814724](http://athena.ohdsi.org/search-terms/terms/44814724)で、 「医療来院履歴をカバーする期間("Period covering healthcare encounters")」の略です。

### VISIT_OCCURRENCE{#visitOccurrence}

VISIT_OCCURRENCE テーブルには、患者の来院履歴に関する情報が格納されています。OHDSIの用語では、これらは来院(Visit)と呼ばれ、目立たないイベントと考えられています。来院には12のトップカテゴリーがあり、医療が提供される可能性のある様々な状況が階層化されています。記録されている最も一般的な訪問は、入院、外来、救急部、非医療機関への訪問です。

#### How Are Lauren's Encounters Represented As Visits?  {-}

例として、VISIT_OCCURRENCE テーブルの表 ＠ref(tab:encounter) で入院患者の遭遇を表現してみましょう。

Table: (\#tab:visitOccurrence) VISIT_OCCURRENCEテーブルの内容

|Column name|Value|Explanation
|:---------------------|:-----------|:--------------------------------------
|VISIT_OCCURRENCE_ ID|514|通常、各レコードの一意の識別子を作成する自動生成された値です。|
|PERSON_ID|1|PERSONテーブルのローレンさんのレコードの外部キーであり、PERSONとVISIT_OCCURRENCEをリンクしています。|
|VISIT_CONCEPT_ID|9201|院患者の訪問を参照する外部キーは[9201](http://athena.ohdsi.org/search-terms/terms/9201)です。|
|VISIT_START_DATE|2013-01-17|来院開始日|
|VISIT_START_ DATETIME|2013-01-17 00:00:00|来院の日時です。時間が不明なので深夜を使用しています。|
|VISIT_END_DATE|2013-01-24|来院の終了日。これが一日の訪問であれば、終了日は開始日と一致しなければなりません。|
|VISIT_END_DATETIME|2013-01-24 00:00:00|来院終了の日時です。時間が不明なので深夜を使用しています。|
|VISIT_TYPE_ CONCEPT_ID|32034|来院記録の出所についての情報を提供します。保険請求書、病院請求書、電子カルテなどに由来します。この例では概念ID[32035](http://athena.ohdsi.org/search-terms/terms/32035) ("Visit derived from EHR encounter record(EHRの来院記録から導き出された来院)") が使用されています。|
|PROVIDER_ID*|NULL|来院レコードに医療機関が関連付けられている場合、その医療機関のIDがこのフィールドに入力されます。これはPROVIDERテーブルのPROVIDER_IDフィールドの内容でなければなりません。|
|CARE_SITE_ID|NULL|来院レコードにCare Siteが関連付けられている場合、そのCare SiteのIDがこのフィールドに入ります。これはCARE_SITEテーブルのCARE_SITE_IDでなければなりません。|
|VISIT_SOURCE_ VALUE|inpatient|ソースデータにある来院に関する値はここに入ります。ローレンさんのデータにはありませんでした。|
|VISIT_SOURCE_ CONCEPT_ID|0|ソースの来院に関する値がOHDSIで認識される用語を使用してコード化されている場合、ソースでのコードを表すCONCEPT_ID値はここに入ります。ローレンさんのデータにはそれがありません。|
|ADMITTED_FROM_ CONCEPT_ID|0|確認できる場合、これには患者がどこから入院したかを表す概念が含まれています。この概念は、ドメイン "Visit "を持つべきです。例えば、患者が自宅から入院した場合、[8536](http://athena.ohdsi.org/search-terms/terms/8536) ("Home")が含まれます。|
|ADMITTED_FROM_ SOURCE_CONCEPT_ID|NULL|患者がどこから入院したかを表すソースからの値です。この例では「自宅」となります。|
|DISCHARGE_TO_ CONCEPT_ID|0|確認できる場合、これは患者がどこに退院したかを表す概念を指します。この概念はドメイン "Visit "に所属するものであるべきです。例えば、患者が福祉施設に退院した場合、概念IDは[8615](http://athena.ohdsi.org/search-terms/terms/8615) ("Assisted Living Facility")となります。|
|DISCHARGE_TO_ SOURCE_VALUE|0|患者がどこに退院したかを表すソースデータにおける退院に関する値です。上記の例では、"Assisted living facility "となります。|
|PRECEDING_VISIT_ OCCURRENCE_ID|NULL|直前の来院を表します。ADMITTED_FROM_CONCEPT_IDとは対照的に、これはVisit Conceptではなく実際のVisit Occurrenceレコードにリンクしています。また、次の来院記録はないことに注意してください。|

* 入院患者の場合によく見られるように、患者は1回の来院で複数の医療提供者を受診することがあります。これらのやり取りはVISIT_DETAILテーブルに記録できます。この章では詳しくは説明しませんが、VISIT_DETAILテーブルについては[CDM wiki](https://github.com/OHDSI/CommonDataModel/wiki/VISIT_DETAIL)をご覧下さい。

### CONDITION_OCCURRENCE{#conditionOccurrence}

CONDITION_OCCURRENCEテーブルのレコードは、医療従事者が観察した、または患者から報告された状態の診断、徴候、または症状です。

#### What Are Lauren's Conditions? {-}

彼女の主張を再びみてみましょう:

> 約3年前、私はまた、痛みを伴っていた私の生理が、ますます痛みを伴うようになっていたことに気付きました。私は、私の大腸のすぐそばに鋭い刺すような痛みを意識し始め、私の尾骨と骨盤の下の領域の周りに柔らかく、膨らみを感じるようになってきました。生理痛がひどくなり、月に1～2日仕事を休むこともありました。鎮痛剤で痛みを和らげることもありましたが、通常はあまり効果がありませんでした。

月経困難症として知られる、痛みを伴う月経痛のSNOMEDコードは 266599000です。表@ref(tab:conditionOccurrence)は、CONDITION_OCCURRENCEテーブルでどのように表現されるかを示してます。

Table: (\#tab:conditionOccurrence) CONDITION_OCCURRENCEテーブルの内容

|Column name|Value|Explanation
|:---------------------|:-----------|:--------------------------------------
|CONDITION_ OCCURRENCE_ID|964|PERSONテーブルのローレンさんのレコードの外部キーであり、PERSONとCONDITION_OCCURRENCEをリンクしています。|
|PERSON_ID|1|PERSONテーブルのローレンさんのレコードの外部キーであり、PERSONとCONDITION_OCCURRENCEをリンクしています。|
|CONDITION_ CONCEPT_ID|194696|SNOMEDコード266599000: [194696](http://athena.ohdsi.org/search-terms/terms/194696)を参照する外部キーです。|
|CONDITION_START_ DATE|2010-01-06|症状のインスタンスが記録された日付。|
|CONDITION_START_ DATETIME|2010-01-06 00:00:00|症状のインスタンスが記録された日時です。時間は不明なので深夜を使用しています。|
|CONDITION_END_ DATE|NULL|状態のインスタンスが終了したと判断された日付ですが、これが記録されることはほとんどありません。|
|CONDITION_END_ DATETIME|NULL|確認できる場合、症状のインスタンスが終了したとみなされた日時です。|
|CONDITION_TYPE_ CONCEPT_ID|32020|このカラムは、レコードの出所に関する情報を提供することを目的としています。この例では、来院が電子カルテの内容に類似しているため、概念[32020](http://athena.ohdsi.org/search-terms/terms/32020) ("EHR encounter diagnosis(電子カルテにおける来院時診断)")が使われ得ています。 このフィールドの概念は、"Condition Type "の用語集の中にあります。|
|CONDITION_STATUS_ CONCEPT_ID|0|確認出来る場合、これは状況や症状について記述します。例えば、ある症状は入院中の診断である可能性があり、その場合は概念ID[4203942](http://athena.ohdsi.org/search-terms/terms/4203942) が使われます。|
|STOP_REASON|NULL|確認できる場合は、ソースデータに示されているように、その症状が存在しなくなった理由を示します。|
|PROVIDER_ID|NULL|症状レコードに診断医師がリストされている場合、その医師のIDがこのフィールドに入ります。これはPROVIDERテーブルのPROVIDER_IDで、診察した医師を表しています。|
|VISIT_OCCURRENCE_ ID|509|VISIT(VISIT_OCCURRENCEテーブルのVISIT_OCCURRENCE_IDへの外部キー)で、症状が診断された訪問先。|
|CONDITION_SOURCE_ VALUE|266599000|症状を表す元のソース値です。ローレンさんの月経困難症の場合、その疾患のSNOMEDコードがここに格納されていますが、そのコードを表す概念はCONDITION_SOURCE_CONCEPT_IDに格納され、そこからマッピングされた標準概念はCONDITION_CONCEPT_IDフィールドに格納されています。|
|CONDITION_SOURCE_ CONCEPT_ID|194696|ソースからの症状に関する値がOHDSIで認識される用語を使ってコード化されている場合、その値を表す概念IDはここに格納されます。この例では、ソースでの値はSNOMEDコードなので、そのコードを表す概念IDは194696となります。この場合、CONDITION_CONCEPT_IDフィールドと同じ値になります。
|CONDITION_STATUS_ SOURCE_VALUE|0|ソースからのCondition Status値がOHDSIがサポートするコーディングスキームを使用してコーディングされている場合、その概念はここに格納されます。|

### DRUG_EXPOSURE{#drugExposure}

DRUG_EXPOSURE テーブルは、患者の体内への薬物投与の意図（指示）または実際の服薬に関する記録を取り込みます。薬物には、処方薬、市販薬、ワクチン、および高分子生物学的療法が含まれる。薬物への曝露は、オーダー、処方箋、薬局での調剤、処置、その他患者からの報告情報に関連する臨床事象から推定されます。


#### How Are Lauren's Drug Exposures Represented?  {-}

月経困難症の疼痛の治療のために、ローレンさんは2010年1月6日の訪問時に、アセトアミノフェン375mg（別名パラセタモール、米国でNDCコード69842087651で販売されているもの）を60錠ずつ30日間経口投与されました。DRUG_EXPOSUREの表は次のようになります。

Table: (\#tab:drugExposure) DRUG_EXPOSUREテーブル

|Column name|Value|Explanation
|:---------------------|:-----------|:--------------------------------------
|DRUG_EXPOSURE_ID|1001|T通常、各レコードの一意の識別子を作成する自動生成された値です。|
|PERSON_ID|1|PERSONテーブルのローレンさんのレコードの外部キーで、PERSONとDRUG_EXPOSUREをリンクしています。|
|DRUG_CONCEPT_ID|1127433|医薬品の概念です。アセトアミノフェンのNDCコードは、概念[1127433](http://athena.ohdsi.org/search-terms/terms/1127433)で表されるRxNormコード313782に対応しています。|
|DRUG_EXPOSURE_ START_DATE|2010-01-06|医薬品曝露の開始日。|
|DRUG_EXPOSURE_ START_DATETIME|2010-01-06 00:00:00|医薬品曝露の開始日時。時間は不明なので深夜を使用しています。|
|DRUG_EXPOSURE_ END_DATE|2010-02-05|医薬品曝露の終了日。患者がまだ医薬品に曝露されていた最終日を示します。情報源にもよりますが、確定されている日付であったり、推測される日付であったりします。この場合、ローレンさんが30日分の薬を持っていたことがわかっているので、この日付が推測されます。|
|DRUG_EXPOSURE_ END_DATETIME|2010-02-05 00:00:00|医薬品曝露の終了日時を示します。DRUG_EXPOSURE_END_DATEについても同様のルールが適用されます。時間が不明なので深夜を使用します。|
|VERBATIM_END_DATE|NULL|この情報源が明示的な実際の終了日を記録していた場合には、それを使います。患者が処方された医薬品の全日数分を使用したと仮定して、終了日を推定しています。|
|DRUG_TYPE_ CONCEPT_ID|38000177|レコードの出所（例えば診療報酬請求、処方箋等）についての情報を提供することを目的としています。この例では概念[38000177](http://athena.ohdsi.org/search-terms/terms/38000177) ("Prescription written（記載された処方箋）") が使われています。|
|STOP_REASON|NULL|本剤の投与が中止された理由。理由としては、レジメンの完了、変更、削除などがあります。この情報を取得することはほとんどありません。|
|REFILLS|NULL|多くの国で処方システムの一部となっている初回処方後の自動再処方の回数。最初の処方箋はカウントされず、値はNULLから始まります。ローレンさんのアセトアミノフェンの場合は再処方はなされていないので値はNULLです。|
|QUANTITY|60|処方箋の原本または調剤記録に記録されている薬の量|
|DAYS_SUPPLY|30|処方された薬の供給日数|
|SIG|NULL|原本の処方箋または調剤記録に記録されている（米国の医薬品処方システムでは容器に印刷されている）医薬品処方箋の指示（"signetur"）。 Signetursは、CDMではまだ標準化されておらず、口頭で提供されている。|
|ROUTE_CONCEPT_ID|4132161|この概念は、患者が曝露された薬剤の投与経路を表すものである。ローレンさんははアセトアミノフェンを経口投与したため、概念ID[4132161](http://athena.ohdsi.org/search-terms/terms/4132161) ("Oral") が使われています。|
|LOT_NUMBER|NULL|製造業者が製造した医薬品の特定の数量またはロットに割り当てられた識別子。この情報はめったに取得されない。|
|PROVIDER_ID|NULL|薬物レコードに処方医師がリストされている場合、その医師のIDがこのフィールドに入ります。その場合、PROVIDERテーブルのPROVIDER_IDが含まれます。|
|VISIT_OCCURRENCE_ ID|509|薬剤が処方された時のVISIT_OCCURRENCEテーブルの外部キー|
|VISIT_DETAIL_ID|NULL|薬剤が処方されたVISIT_DETAILテーブルの外部キーです。|
|DRUG_SOURCE_ VALUE|69842087651|ソースデータに表示されている薬剤のコードです。ローレンさんの場合、NDCコードはここに格納されています。|
|DRUG_SOURCE_ CONCEPT_ID|750264|ソースでの薬剤の値を表す概念です。概念[750264](http://athena.ohdsi.org/search-terms/terms/750264) は"Acetaminophen 325 MG Oral Tablet "のNDCコードを表しています。
|ROUTE_SOURCE_ VALUE|NULL|ソースに記載されている投与経路に関する詳細な情報。|

### PROCEDURE_OCCURRENCE{#procedureOccurrence}

 PROCEDURE_OCCURRENCE テーブルには、医療提供者が診断目的または治療目的で患者に処方したり、投与したりした活動やプロセスの記録が含まれています。処置は、標準化のレベルが異なる様々な形で、様々なデータソースに存在しています。例えば、以下のようなものがあります。

 * 診療報酬請求書には、提供された医療サービスの請求書の一部として提出され、実施された処置の処置コードが含まれています。
 * 電子カルテにオーダとして記録された処置。
  
#### What Procedures Did Lauren Have?  {-}

彼女の説明から、私たちは彼女が2013-01-14に彼女の左卵巣の超音波検査を受けて4x5cmの嚢胞を見つけたことを把握しています。これがPROCEDURE_OCCURRENCEテーブルでどのように見えるかを示します。

Table: (\#tab:procedureOccurrence)PROCEDURE_OCCURRENCEテーブル

|Column name|Value|Explanation
|:---------------------|:-----------|:--------------------------------------
|PROCEDURE_ OCCURRENCE_ID|1277|通常、各レコードの一意の識別子を作成する自動生成された値です。|
|PERSON_ID|1|PERSONテーブルのローレンさんのレコードに対する外部キーであり、PERSONをPROCEDURE_OCCURRENCEにリンクしています。|
|PROCEDURE_ CONCEPT_ID|4127451|SNOMEDの骨盤超音波検査の検査コードは304435002で、概念[4127451](http://athena.ohdsi.org/search-terms/terms/4127451)で表されています。|
|PROCEDURE_DATE|2013-01-14|処置が実施された日付|
|PROCEDURE_ DATETIME|2013-01-14 00:00:00|T処置が行われた日付と時間。時間は不明なので深夜とします。|
|PROCEDURE_TYPE_ CONCEPT_ID|38000275|このカラムは手順レコードの出所についての情報を提供することを目的としています。この例では、処置のレコードが電子カルテからのものであるため、 概念ID[38000275](http://athena.ohdsi.org/search-terms/terms/38000275) ("EHR order list entry"(電子カルテにおけるオーダー))が使われています。|
|MODIFIER_CONCEPT_ ID|0|処置の修飾子を表す概念ID。例えばCPT4において手技が両側で行われたと記録に記載されていた場合、概念ID[42739579](http://athena.ohdsi.org/search-terms/terms/42739579) ("Bilateral procedure")が使われます。|
|QUANTITY|0|オーダあるいは実施された処置の量。欠落している場合、0と1という数字はすべて同じ意味になります。|
|PROVIDER_ID|NULL|処置レコードに医師が記載されている場合、その医師のIDがこのフィールドに入ります。これはPROVIDERテーブルのPROVIDER_IDへの外部キーでなければなりません。|
|VISIT_OCCURRENCE_ ID|740|確認出来る場合、処置が実行されたVISIT(VISIT_OCCURRENCEテーブルから取得したVISIT_occurrence_idで表されます)です。|
|VISIT_DETAIL_ID|NULL|確認出来る場合、処置が実行されたVISITの詳細(VISIT_DETAILテーブルから取得したVISIT_detail_idで表されます)です。|
|PROCEDURE_SOURCE_ VALUE|304435002|ソースデータに表示される処置のコードまたは情報|
|PROCEDURE_SOURCE_ CONCEPT_ID|4127451|ソースデータでの処置を表す概念です。|
|MODIFIER_SOURCE_ VALUE|NULL|ソースデータでの修飾子のコードです。|

## Additional Information

この章では、データがどのように表現されるかの例として、CDMで利用可能な表の一部のみを取り上げます。詳細はwikiサイト[^cdmWikiUrl]を参照してください。

[^cdmWikiUrl]: https://github.com/OHDSI/CommonDataModel/wiki

## Summary

```{block2, type="rmdsummary"}

- CDMは、幅広い観察研究活動を支援するために設計されています。

- CDM は人を中心としたモデルです。

- CDM はデータの構造を標準化するだけでなく、標準化された用語集を通して内容の表現も標準化しています。

- ソースデータのコードは CDM で管理されており、完全なトレーサビリティが確保されています。

```

## Exercises

#### Prerequisites {-}

これらの最初の演習では、先ほど説明した CDMのテーブルについて復習する必要があり、ATHENA[^athenaCdmUrl]やATLAS[^atlasCdmUrl]を使って用語集の概念を調べる必要があります。

[^athenaCdmUrl]: http://athena.ohdsi.org/
[^atlasCdmUrl]: http://atlas-demo.ohdsi.org

```{exercise, exerciseJohnPerson}
ジョンは、1974年8月4日生まれのアフリカ系アメリカ人男性。 この情報をコード化したPERSONテーブルのエントリを定義してください。
```

```{exercise, exerciseJohnOp}
ジョンは2015年1月1日に現在の保険に加入しました。彼の保険データベースからのデータは、2019年7月1日に抽出されました。この情報をコード化したOBSERVATION_PERIODテーブルのエントリを定義してください。
```

```{exercise, exerciseJohnDrug}
ジョンは2019年5月1日にイブプロフェン200mg経口錠（NDCコード：76168009520）を30日分処方されました。この情報をコード化するDRUG_EXPOSUREテーブルのエントリを定義してください。
```

#### Prerequisites {-}

これらの最後の 3 つの演習では、R、R-Studio、Java がセクション＠ref(installR)で説明されているようにインストールされていることを前提としています。また，[SqlRender](https://ohdsi.github.io/SqlRender/), [DatabaseConnector](https://ohdsi.github.io/DatabaseConnector/), [Eunomia](https://ohdsi.github.io/Eunomia/)パッケージも必要です。これらのパッケージは次のようにしてインストールすることができます。

```{r eval=FALSE}
install.packages(c("SqlRender", "DatabaseConnector", "devtools"))
devtools::install_github("ohdsi/Eunomia", ref = "v1.0.0")
```

Eunomiaパッケージは、ローカルのRセッション内で実行されるCDM内のシミュレートされたデータセットを提供します。接続の詳細は以下のようにして得られます。

```{r eval=FALSE}
connectionDetails <- Eunomia::getEunomiaConnectionDetails()
```

CDMデータベースのスキーマは "main "です。

```{exercise, exerciseGiBleedRecords}
SQLとRを使って、条件「胃腸出血」(概念ID[192671](http://athena.ohdsi.org/search-terms/terms/192671))のすべてのレコードを検索します。

```

```{exercise, exercisePersonSource}
SQLとRを使用して、ソースデータのコードを使用して症状「胃腸出血」のすべてのレコードを取得します。このデータベースはICD-10を使用しており、関連するICD-10コードは "K92.2 "です。
```

```{exercise, exercisePerson61Records}
SQLとRを使って、PERSON_ID 61の人の観察期間を取得します。

```

回答は、付録\@ref(Cdmanswers)に掲載されています。
